<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AttackCounter Mod: Interactive Documentation</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    },
                    colors: {
                        mc: {
                            bg: '#f0f0f2',
                            panel: '#ffffff',
                            dark: '#1e1e1e',
                            green: '#55efc4',
                            red: '#ff7675',
                            gold: '#ffeaa7',
                            accent: '#6c5ce7'
                        }
                    }
                }
            }
        }
    </script>
    <style>
        body { background-color: #f0f0f2; color: #2d3436; }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 400px;
        }
        @media (min-width: 768px) {
            .chart-container { height: 350px; }
        }
        .mc-hud-text {
            text-shadow: 2px 2px 0px rgba(0,0,0,0.5);
        }
        .flow-arrow::after {
            content: '‚ñº';
            display: block;
            text-align: center;
            color: #cbd5e1;
            margin: 0.5rem 0;
        }
        @media (min-width: 768px) {
            .flow-arrow-h::after {
                content: '‚ñ∂';
                display: inline-block;
                margin: 0 1rem;
            }
            .flow-arrow::after { display: none; }
        }
    </style>
    <!-- Chosen Palette: Minimalist Tech (Warm Neutrals & Code Colors) -->
    <!-- Application Structure Plan: 
         1. Hero/Intro: High-level overview of the mod's purpose.
         2. Live Simulator (The "Wow" factor): A functional JS replica of the mod's logic (CombatTracker) allowing users to "play" the mod in the browser.
         3. Configuration Dashboard: Interactive form to adjust settings, updating a live JSON preview and affecting the Simulator's logic.
         4. Technical Architecture: A visual block diagram explaining the internal data flow (Mixins -> Tracker -> HUD).
         5. Installation & Usage: Tabulated reference for setup and keys.
         Why: This structure moves from "Experience" (Simulator) to "Customization" (Config) to "Understanding" (Tech), catering to both players and developers.
    -->
    <!-- Visualization & Content Choices:
         1. Simulator HUD: HTML/CSS overlay. Goal: Demonstrate "Core Functionality". Interaction: Buttons to trigger logic.
         2. Combo Logic Chart: Chart.js Line Chart. Goal: Visualize "Combo Reset Time". Interaction: Updates in real-time as user "attacks". Justification: Shows the concept of the 60-tick window visually.
         3. Tech Flow: CSS Grid Layout. Goal: Explain "Data Flow". Interaction: Click nodes for details. Justification: Cleaner than static text.
         4. Config Preview: Dynamic Text Block. Goal: Show "Configurability". Interaction: Form inputs update text.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
</head>
<body class="font-sans antialiased">

    <!-- Navigation -->
    <nav class="bg-mc-dark text-white p-4 sticky top-0 z-50 shadow-lg">
        <div class="max-w-6xl mx-auto flex justify-between items-center">
            <div class="font-bold text-xl tracking-tight font-mono text-mc-green">AttackCounter<span class="text-gray-400 text-sm ml-2">v1.21.5</span></div>
            <div class="hidden md:flex space-x-6 text-sm font-medium">
                <a href="#simulator" class="hover:text-mc-green transition">Simulator</a>
                <a href="#config" class="hover:text-mc-green transition">Configuration</a>
                <a href="#technical" class="hover:text-mc-green transition">Architecture</a>
                <a href="#install" class="hover:text-mc-green transition">Installation</a>
            </div>
        </div>
    </nav>

    <!-- Main Container -->
    <main class="max-w-6xl mx-auto p-4 md:p-8 space-y-12">

        <!-- Introduction -->
        <section class="text-center space-y-4 py-8">
            <h1 class="text-4xl md:text-5xl font-bold text-gray-800">Master Your Combat Metrics</h1>
            <p class="text-lg text-gray-600 max-w-2xl mx-auto">
                A lightweight, client-side Fabric mod that brings real-time analytics to your Minecraft HUD. Track combos, monitor damage output, and analyze defensive performance without interrupting gameplay.
            </p>
            <div class="flex justify-center gap-4 pt-4">
                <span class="px-3 py-1 bg-gray-200 rounded-full text-xs font-mono text-gray-600">Fabric 1.21.5</span>
                <span class="px-3 py-1 bg-gray-200 rounded-full text-xs font-mono text-gray-600">Client-Side</span>
                <span class="px-3 py-1 bg-gray-200 rounded-full text-xs font-mono text-gray-600">Java 21</span>
            </div>
        </section>

        <!-- Interactive Simulator Section -->
        <section id="simulator" class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
            <div class="p-6 md:p-8 border-b border-gray-100">
                <h2 class="text-2xl font-bold text-gray-800 mb-2">Live HUD Simulator</h2>
                <p class="text-gray-600 mb-4">
                    Experience the core functionality of <strong>AttackCounter</strong> right here. This interactive demo runs the actual logic found in `CombatTracker.java`. 
                    Click the buttons to simulate combat events and watch the HUD react. Observe how the <strong>Combo</strong> resets if you wait too long (default 3s).
                </p>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 p-6 md:p-8 bg-gray-50">
                <!-- Left: Controls & Game View -->
                <div class="space-y-6">
                    <!-- HUD Preview Window -->
                    <div class="relative w-full h-64 bg-gray-800 rounded-lg shadow-inner flex items-end justify-center pb-8 overflow-hidden bg-[url('https://www.transparenttextures.com/patterns/cubes.png')]">
                        <!-- Simulated Hotbar -->
                        <div class="absolute bottom-0 w-full h-12 bg-gray-900 opacity-50 border-t border-gray-700"></div>
                        
                        <!-- The Mod HUD -->
                        <div id="hud-display" class="relative z-10 transition-opacity duration-300 opacity-0 mb-4 px-4 py-2 bg-black/60 rounded backdrop-blur-sm text-white font-mono text-sm md:text-base mc-hud-text border border-white/10 shadow-lg transform transition-transform duration-200">
                            <!-- Content injected via JS -->
                        </div>

                        <!-- Status Indicator -->
                        <div id="mod-status" class="absolute top-4 right-4 text-xs font-mono text-mc-green bg-black/50 px-2 py-1 rounded">
                            Mod: Enabled
                        </div>
                    </div>

                    <!-- Controls -->
                    <div class="grid grid-cols-2 gap-4">
                        <button onclick="simAttack()" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded shadow active:transform active:scale-95 transition flex items-center justify-center gap-2">
                            <span>‚öîÔ∏è</span> Deal Hit
                        </button>
                        <button onclick="simReceive()" class="bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-4 rounded shadow active:transform active:scale-95 transition flex items-center justify-center gap-2">
                            <span>üõ°Ô∏è</span> Take Hit
                        </button>
                    </div>
                    <div class="flex justify-between items-center text-sm text-gray-500">
                        <span>Press <strong>'K'</strong> to toggle mod (simulated)</span>
                        <button onclick="toggleMod()" class="text-gray-400 hover:text-gray-600 underline">Manual Toggle</button>
                    </div>
                </div>

                <!-- Right: Logic Visualization (Chart) -->
                <div class="bg-white p-4 rounded-lg shadow-sm border border-gray-200 flex flex-col">
                    <h3 class="font-bold text-gray-700 mb-2 text-sm uppercase tracking-wide">Combo Logic Visualizer</h3>
                    <p class="text-xs text-gray-500 mb-4">
                        Visualizes the combo counter relative to the `comboResetTime`. Each hit resets the decay timer.
                    </p>
                    <div class="chart-container flex-grow">
                        <canvas id="comboChart"></canvas>
                    </div>
                </div>
            </div>
        </section>

        <!-- Configuration Section -->
        <section id="config" class="grid grid-cols-1 md:grid-cols-3 gap-8">
            <div class="md:col-span-2 space-y-6">
                <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6 md:p-8">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">Configuration & Customization</h2>
                    <p class="text-gray-600 mb-6">
                        Customize behavior via `config/attackcounter.json`. Adjust timings to fit your PVP style or toggle specific metrics to keep your HUD clean. 
                        Changes below update the Simulator logic above instantly.
                    </p>

                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
                        <!-- Toggles -->
                        <div class="space-y-3">
                            <h4 class="font-semibold text-gray-700 border-b pb-2">Visibility Toggles</h4>
                            <label class="flex items-center space-x-3 cursor-pointer">
                                <input type="checkbox" id="cfg-showCombo" checked onchange="updateConfig()" class="w-5 h-5 text-blue-600 rounded focus:ring-blue-500 border-gray-300">
                                <span class="text-gray-700">Show Combo</span>
                            </label>
                            <label class="flex items-center space-x-3 cursor-pointer">
                                <input type="checkbox" id="cfg-showHitsDealt" checked onchange="updateConfig()" class="w-5 h-5 text-blue-600 rounded focus:ring-blue-500 border-gray-300">
                                <span class="text-gray-700">Show Hits Dealt</span>
                            </label>
                            <label class="flex items-center space-x-3 cursor-pointer">
                                <input type="checkbox" id="cfg-showDmgDealt" checked onchange="updateConfig()" class="w-5 h-5 text-blue-600 rounded focus:ring-blue-500 border-gray-300">
                                <span class="text-gray-700">Show Damage Dealt</span>
                            </label>
                            <label class="flex items-center space-x-3 cursor-pointer">
                                <input type="checkbox" id="cfg-showHitsRec" checked onchange="updateConfig()" class="w-5 h-5 text-blue-600 rounded focus:ring-blue-500 border-gray-300">
                                <span class="text-gray-700">Show Hits Received</span>
                            </label>
                        </div>

                        <!-- Sliders -->
                        <div class="space-y-4">
                            <h4 class="font-semibold text-gray-700 border-b pb-2">Timing & Layout</h4>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Combo Reset Time (Ticks)</label>
                                <div class="flex items-center gap-2">
                                    <input type="range" id="cfg-resetTime" min="20" max="200" value="60" step="10" oninput="updateConfig()" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                                    <span id="val-resetTime" class="text-xs font-mono bg-gray-100 px-2 py-1 rounded">60</span>
                                </div>
                                <p class="text-xs text-gray-400 mt-1">20 ticks = 1 second</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">HUD Offset Y</label>
                                <div class="flex items-center gap-2">
                                    <input type="range" id="cfg-offsetY" min="-50" max="50" value="0" step="5" oninput="updateConfig()" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                                    <span id="val-offsetY" class="text-xs font-mono bg-gray-100 px-2 py-1 rounded">0</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- JSON Preview -->
            <div class="md:col-span-1">
                <div class="bg-mc-dark rounded-xl shadow-lg p-6 h-full text-gray-300 font-mono text-sm overflow-hidden flex flex-col">
                    <div class="flex justify-between items-center mb-4 border-b border-gray-700 pb-2">
                        <span class="text-mc-gold font-bold">attackcounter.json</span>
                        <div class="flex space-x-1">
                            <div class="w-3 h-3 rounded-full bg-red-500"></div>
                            <div class="w-3 h-3 rounded-full bg-yellow-500"></div>
                            <div class="w-3 h-3 rounded-full bg-green-500"></div>
                        </div>
                    </div>
                    <pre id="json-preview" class="flex-grow overflow-auto whitespace-pre-wrap text-xs md:text-sm leading-relaxed"></pre>
                </div>
            </div>
        </section>

        <!-- Technical Architecture Section -->
        <section id="technical" class="space-y-6">
             <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6 md:p-8">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">Technical Architecture</h2>
                <p class="text-gray-600 mb-8">
                    Understanding the data flow is crucial for developers and curious players. The mod uses <strong>Mixins</strong> to intercept game events, a central <strong>CombatTracker</strong> to process logic, and a <strong>CombatHud</strong> renderer. Click any block below to see implementation details.
                </p>

                <!-- Interactive Block Diagram -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 items-stretch text-center">
                    
                    <!-- Input Layer -->
                    <div onclick="showTechDetail('input')" class="bg-blue-50 border-2 border-blue-100 rounded-lg p-4 cursor-pointer hover:bg-blue-100 transition group relative">
                        <div class="text-blue-600 text-2xl mb-2">üéÆ</div>
                        <h4 class="font-bold text-gray-700">Events</h4>
                        <div class="text-xs text-gray-500 mt-1">Attack & Damage</div>
                        <div class="absolute inset-0 border-2 border-blue-400 rounded-lg opacity-0 group-hover:opacity-100 transition"></div>
                    </div>

                    <div class="hidden md:flex items-center justify-center flow-arrow-h text-gray-300"></div>
                    <div class="md:hidden flow-arrow"></div>

                    <!-- Processing Layer -->
                    <div onclick="showTechDetail('process')" class="bg-purple-50 border-2 border-purple-100 rounded-lg p-4 cursor-pointer hover:bg-purple-100 transition group relative">
                        <div class="text-purple-600 text-2xl mb-2">‚öôÔ∏è</div>
                        <h4 class="font-bold text-gray-700">CombatTracker</h4>
                        <div class="text-xs text-gray-500 mt-1">Logic & State</div>
                        <div class="absolute inset-0 border-2 border-purple-400 rounded-lg opacity-0 group-hover:opacity-100 transition"></div>
                    </div>

                    <div class="hidden md:flex items-center justify-center flow-arrow-h text-gray-300"></div>
                    <div class="md:hidden flow-arrow"></div>

                    <!-- Output Layer -->
                    <div onclick="showTechDetail('output')" class="bg-green-50 border-2 border-green-100 rounded-lg p-4 cursor-pointer hover:bg-green-100 transition group relative">
                        <div class="text-green-600 text-2xl mb-2">üñ•Ô∏è</div>
                        <h4 class="font-bold text-gray-700">CombatHud</h4>
                        <div class="text-xs text-gray-500 mt-1">Rendering</div>
                        <div class="absolute inset-0 border-2 border-green-400 rounded-lg opacity-0 group-hover:opacity-100 transition"></div>
                    </div>
                </div>

                <!-- Dynamic Detail Panel -->
                <div id="tech-detail-panel" class="mt-8 bg-gray-50 rounded-lg p-6 border-l-4 border-blue-500 transition-all duration-300">
                    <h3 id="tech-title" class="text-lg font-bold text-gray-800">Event Interception</h3>
                    <p id="tech-desc" class="text-gray-600 mt-2 text-sm leading-relaxed">
                        The mod hooks into Minecraft's <code>AttackEntityCallback</code> to detect player attacks. For damage calculations, it uses <strong>Mixins</strong>:
                        <br><br>
                        <code class="bg-gray-200 px-1 rounded text-xs">LivingEntityMixin</code> injects into the <code>damage</code> method @At("RETURN"). This ensures stats are only updated if damage is actually applied.
                    </p>
                </div>
             </div>
        </section>

        <!-- Installation & Keys -->
        <section id="install" class="grid grid-cols-1 md:grid-cols-2 gap-8 pb-12">
            <!-- Installation Steps -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                <h3 class="font-bold text-gray-800 text-lg mb-4 flex items-center">
                    <span class="bg-gray-100 w-8 h-8 rounded-full flex items-center justify-center mr-2 text-sm">‚¨áÔ∏è</span> 
                    Installation Guide
                </h3>
                <ul class="space-y-4">
                    <li class="flex items-start">
                        <span class="font-mono text-gray-400 mr-3">01</span>
                        <p class="text-sm text-gray-600">Install <strong>Fabric Loader</strong> and <strong>Fabric API</strong> for Minecraft 1.21.5.</p>
                    </li>
                    <li class="flex items-start">
                        <span class="font-mono text-gray-400 mr-3">02</span>
                        <p class="text-sm text-gray-600">Download <code>attackcounter.jar</code> from the releases page.</p>
                    </li>
                    <li class="flex items-start">
                        <span class="font-mono text-gray-400 mr-3">03</span>
                        <p class="text-sm text-gray-600">Place the file in your <code>.minecraft/mods</code> folder.</p>
                    </li>
                    <li class="flex items-start">
                        <span class="font-mono text-gray-400 mr-3">04</span>
                        <p class="text-sm text-gray-600">Launch the game using the Fabric profile. Config is generated on first run.</p>
                    </li>
                </ul>
            </div>

            <!-- Keybindings -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                <h3 class="font-bold text-gray-800 text-lg mb-4 flex items-center">
                    <span class="bg-gray-100 w-8 h-8 rounded-full flex items-center justify-center mr-2 text-sm">‚å®Ô∏è</span> 
                    Controls & Commands
                </h3>
                <div class="overflow-hidden rounded-lg border border-gray-200">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Action</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Default Key</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                            <tr>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">Toggle Mod</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-mono text-blue-600 bg-blue-50 inline-block m-2 rounded">K</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <div class="mt-4 text-xs text-gray-500 bg-gray-50 p-3 rounded border border-gray-100">
                    <strong>Note:</strong> Toggling the mod prints a status message to the chat/action bar.
                </div>
            </div>
        </section>

    </main>

    <footer class="bg-gray-800 text-gray-400 py-8 text-center text-sm">
        <p>AttackCounter &copy; 2025 | Built for Minecraft Fabric</p>
    </footer>

    <!-- Logic Script -->
    <script>
        // --- State Management ---
        const state = {
            enabled: true,
            combo: 0,
            hitsDealt: 0,
            hitsRec: 0,
            dmgDealt: 0,
            dmgRec: 0,
            lastHitTime: 0,
            displayTimer: 0,
            
            // Config
            config: {
                comboResetTime: 60, // ticks
                displayDuration: 100, // ticks
                showCombo: true,
                showHitsDealt: true,
                showHitsRec: true,
                showDmgDealt: true,
                showDmgRec: true,
                hudOffsetY: 0
            }
        };

        // --- Chart Setup ---
        const ctx = document.getElementById('comboChart').getContext('2d');
        const comboChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: [], // Time labels
                datasets: [{
                    label: 'Combo Count',
                    data: [],
                    borderColor: '#55efc4',
                    backgroundColor: 'rgba(85, 239, 196, 0.2)',
                    tension: 0.1,
                    fill: true,
                    stepped: true
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                animation: false,
                plugins: {
                    legend: { display: false },
                    tooltip: {
                        callbacks: {
                            label: function(context) { return `Combo: ${context.parsed.y}`; }
                        }
                    }
                },
                scales: {
                    y: { beginAtZero: true, suggestedMax: 5, grid: { color: '#f3f4f6' } },
                    x: { display: false }
                }
            }
        });

        // --- Simulation Logic (Mimicking Java Code) ---
        let currentTick = 0;
        const TICK_RATE_MS = 50; // 20 ticks per second = 50ms per tick

        function gameLoop() {
            currentTick++;
            
            // Check combo reset
            if (state.combo > 0 && (currentTick - state.lastHitTime > state.config.comboResetTime)) {
                resetStats();
                updateChart(0);
            }

            // Display timer decay
            if (state.displayTimer > 0) {
                state.displayTimer--;
            }

            updateHUD();
        }

        setInterval(gameLoop, TICK_RATE_MS);

        function resetStats() {
            state.combo = 0;
            state.hitsDealt = 0;
            state.hitsRec = 0;
            state.dmgDealt = 0;
            state.dmgRec = 0;
            state.displayTimer = 0;
            updateHUD();
        }

        // --- Interactions ---
        function simAttack() {
            if (!state.enabled) return;

            // Logic from CombatTracker.onPlayerAttack
            if (currentTick - state.lastHitTime <= state.config.comboResetTime) {
                state.combo++;
            } else {
                state.combo = 1;
                state.hitsDealt = 0;
                state.dmgDealt = 0;
            }

            state.hitsDealt++;
            state.dmgDealt += Math.floor(Math.random() * 5) + 3; // Random dmg 3-8
            state.lastHitTime = currentTick;
            state.displayTimer = state.config.displayDuration;
            
            updateChart(state.combo);
            updateHUD();
            animateHudBump();
        }

        function simReceive() {
            if (!state.enabled) return;
            
            state.hitsRec++;
            state.dmgRec += Math.floor(Math.random() * 4) + 1;
            state.displayTimer = state.config.displayDuration;
            
            updateHUD();
            animateHudBump();
        }

        function toggleMod() {
            state.enabled = !state.enabled;
            const statusEl = document.getElementById('mod-status');
            statusEl.innerText = state.enabled ? "Mod: Enabled" : "Mod: Disabled";
            statusEl.className = state.enabled 
                ? "absolute top-4 right-4 text-xs font-mono text-mc-green bg-black/50 px-2 py-1 rounded"
                : "absolute top-4 right-4 text-xs font-mono text-red-400 bg-black/50 px-2 py-1 rounded";
        }

        // --- Updates & Rendering ---
        function updateChart(val) {
            // Keep last 20 points
            if (comboChart.data.labels.length > 20) {
                comboChart.data.labels.shift();
                comboChart.data.datasets[0].data.shift();
            }
            comboChart.data.labels.push(currentTick);
            comboChart.data.datasets[0].data.push(val);
            comboChart.update();
        }

        function updateHUD() {
            const hud = document.getElementById('hud-display');
            
            // Fade logic
            if (state.displayTimer <= 0 || !state.enabled) {
                hud.style.opacity = '0';
                return;
            } else if (state.displayTimer < 20) {
                hud.style.opacity = (state.displayTimer / 20).toString();
            } else {
                hud.style.opacity = '1';
            }

            // Offset logic
            hud.style.marginTop = `${state.config.hudOffsetY}px`;

            // Text Build Logic (From CombatHud.java)
            let parts = [];
            if (state.config.showCombo && state.combo > 0) parts.push(`<span class="text-mc-gold">Combo:</span> <span class="text-yellow-200">${state.combo}</span>`);
            if (state.config.showHitsDealt && state.hitsDealt > 0) parts.push(`<span class="text-mc-green">Hits:</span> <span class="text-white">${state.hitsDealt}</span>`);
            if (state.config.showHitsRec && state.hitsRec > 0) parts.push(`<span class="text-mc-red">Rec:</span> <span class="text-white">${state.hitsRec}</span>`);
            if (state.config.showDmgDealt && state.dmgDealt > 0) parts.push(`<span class="text-mc-green">Dmg:</span> <span class="text-white">${state.dmgDealt.toFixed(1)}</span>`);
            if (state.config.showDmgRec && state.dmgRec > 0) parts.push(`<span class="text-mc-red">Dmg:</span> <span class="text-white">${state.dmgRec.toFixed(1)}</span>`);

            hud.innerHTML = parts.join(' <span class="text-gray-500 mx-1">|</span> ');
        }

        function animateHudBump() {
            const hud = document.getElementById('hud-display');
            hud.classList.remove('scale-105');
            void hud.offsetWidth; // trigger reflow
            hud.classList.add('scale-105');
            setTimeout(() => hud.classList.remove('scale-105'), 100);
        }

        // --- Configuration Handling ---
        function updateConfig() {
            state.config.showCombo = document.getElementById('cfg-showCombo').checked;
            state.config.showHitsDealt = document.getElementById('cfg-showHitsDealt').checked;
            state.config.showDmgDealt = document.getElementById('cfg-showDmgDealt').checked;
            state.config.showHitsRec = document.getElementById('cfg-showHitsRec').checked;
            
            state.config.comboResetTime = parseInt(document.getElementById('cfg-resetTime').value);
            state.config.hudOffsetY = parseInt(document.getElementById('cfg-offsetY').value);

            // Update UI Labels
            document.getElementById('val-resetTime').innerText = state.config.comboResetTime;
            document.getElementById('val-offsetY').innerText = state.config.hudOffsetY;

            renderJsonPreview();
            updateHUD(); // force refresh
        }

        function renderJsonPreview() {
            const preview = {
                "enabled": state.enabled,
                "comboResetTime": state.config.comboResetTime,
                "displayDuration": state.config.displayDuration,
                "showCombo": state.config.showCombo,
                "showHitsDealt": state.config.showHitsDealt,
                "showHitsReceived": state.config.showHitsRec,
                "showDamageDealt": state.config.showDmgDealt,
                "showDamageReceived": state.config.showDmgRec,
                "hudOffsetY": state.config.hudOffsetY
            };
            document.getElementById('json-preview').innerText = JSON.stringify(preview, null, 2);
        }

        // --- Tech Panel Logic ---
        const techDetails = {
            'input': {
                title: 'Event Interception (Hooks)',
                desc: 'The mod initiates via <code>AttackCounterClient.java</code>. It registers an <code>AttackEntityCallback</code> which fires whenever the player left-clicks an entity. Simultaneously, Mixins in <code>LivingEntityMixin.java</code> listen for the <code>damage</code> method to accurately track when damage is actually applied or received, preventing false positives from blocked attacks.'
            },
            'process': {
                title: 'CombatTracker Logic',
                desc: 'Located in <code>CombatTracker.java</code>, this is the brain of the mod. It maintains a <code>currentTick</code> counter. On every hit, it compares the current tick to <code>lastHitTime</code>. If the difference is less than <code>comboResetTime</code> (default 60 ticks), the combo increments. Otherwise, it resets to 1. It also manages the <code>displayTimer</code> which determines how long the HUD stays visible.'
            },
            'output': {
                title: 'HUD Rendering',
                desc: '<code>CombatHud.java</code> handles drawing to the screen. It runs on the render thread via <code>HudRenderCallback</code>. It constructs a text string based on active config flags, calculates the centered position (minus text width), applies the <code>hudOffsetY</code>, and renders the text with a shadow. It also calculates an alpha value to fade the text out as the display timer nears zero.'
            }
        };

        function showTechDetail(key) {
            const panel = document.getElementById('tech-detail-panel');
            const title = document.getElementById('tech-title');
            const desc = document.getElementById('tech-desc');
            
            // Visual feedback
            panel.classList.remove('border-blue-500', 'border-purple-500', 'border-green-500');
            
            let color = 'border-blue-500'; // default
            if (key === 'process') color = 'border-purple-500';
            if (key === 'output') color = 'border-green-500';
            
            panel.classList.add(color);
            
            // Content update
            title.innerHTML = techDetails[key].title;
            desc.innerHTML = techDetails[key].desc;
        }

        // --- Init ---
        // Keyboard listener for 'K'
        document.addEventListener('keydown', (e) => {
            if (e.key.toLowerCase() === 'k') {
                toggleMod();
            }
        });

        updateConfig(); // Initial render
    </script>
</body>
</html>